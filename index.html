<!DOCTYPE html>
<html>
  <head>
    <title>Kalkulator Himpunan</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="./lib/js/jquery-3.7.0.min.js"></script>
    <href rel="stylesheet" href="./lib/CSS/fontawesome.css"></href>
    <script src="./lib/js/font-awesome.js"></script>
    <style>
      body {
        background-color: #f5f5f5;
        font-family: Arial, sans-serif;
      }
      .container {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .set {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      .set .char-input {
        width: 30px;
        margin: 0 10px;
        border: none;
        border-bottom: 1px solid #ccc;
        font-size: 16px;
        padding: 5px;
        text-align: center;
      }
      .set .set-input {
        margin: 0 10px;
        border: none;
        border-bottom: 1px solid #ccc;
        font-size: 16px;
        padding: 5px;
      }

      .set button:hover {
        color: #333;
      }
      .removeSet {
        background-color: #ff4d4d;
        border: none;

        color: #ffffff;
        font-size: 16px;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }
      .removeSet:hover {
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
      .removeSet i {
        margin-right: 5px;
      }
      .removeSet span {
        display: none;
      }
      .removeSet:hover span {
        display: inline;
      }
      .removeSet:hover i {
        display: none;
      }
      .operations {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
      }
      .operations button {
        background-color: #fff;
        border: none;
        color: #999;
        font-size: 24px;
        cursor: pointer;
        margin: 0 10px;
        padding: 5px 10px;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }
      .operations button:hover {
        color: #333;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
      .set-operation {
        width: 100%;
        margin-bottom: 10px;
        border: none;
        border-bottom: 1px solid #ccc;
        font-size: 16px;
        padding: 5px;
      }
      .result {
        width: 100%;
        margin-bottom: 10px;
        border: none;
        border-bottom: 1px solid #ccc;
        font-size: 16px;
        padding: 5px;
        text-align: center;
      }
      button {
        background-color: #007acc;
        border: none;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
        padding: 10px 20px;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }
      button:hover {
        background-color: #0062a3;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="set">
        <input
          type="text"
          placeholder="Char Himpunan"
          class="char-input"
          maxlength="1"
        />
        <span>{</span>
        <input type="text" placeholder="Isi Himpunan" class="set-input" />
        <span>}</span
        ><button class="removeSet">
          <i class="fa fa-trash" aria-hidden="true"></i>
        </button>
      </div>
      <div class="set">
        <input
          type="text"
          placeholder="Char Himpunan"
          class="char-input"
          maxlength="1"
        />
        <span>{</span>
        <input type="text" placeholder="Isi Himpunan" class="set-input" />
        <span>}</span>
        <button class="removeSet">
          <i class="fa fa-trash" aria-hidden="true"></i>
        </button>
      </div>
      <button id="addSet">Tambah Himpunan</button>
      <div class="operations">
        <button id="intersection">&#8745;</button>
        <button id="union">&#8746;</button>
        <button id="symmetricDifference">&#8853;</button>
        <button id="addition">+</button>
        <button id="subtraction">-</button>
        <button id="difference">&#8726;</button>
        <button id="complement">&#8705;</button>
      </div>
      <input type="text" placeholder="Set-Operation" class="set-operation" />
      <button id="calculate">Hitung</button>
      <input type="text" placeholder="Result" class="result" />
    </div>
    <script>
      $(document).ready(() => {
        $("#addSet").click(() => {
          const set = $(
            ` <div class="set"> <input type="text" placeholder="Char Himpunan" class="char-input" maxlength="1"/> <span>{</span> <input type="text" placeholder="Isi Himpunan" class="set-input" /> <span>}</span> <button class="removeSet"><i class="fa fa-trash" aria-hidden="true"></i></button> </div> `
          );
          $(".container").find("#addSet").before(set);
          toggleRemoveButtons($(".removeSet"));
        });

        function toggleRemoveButtons(removeButtons) {
          if (removeButtons.length > 2) {
            removeButtons.each((index, button) => {
              $(button).css("display", "block");
              $(button).click(() => {
                $(button).parent().remove();
                toggleRemoveButtons($(".removeSet"));
              });
            });
          } else {
            removeButtons.each((index, button) => {
              $(button).css("display", "none");
            });
          }
        }

        toggleRemoveButtons($(".removeSet"));

        $(document).on(
          "click",
          "#intersection, #union, #addition, #subtraction, #difference, #complement, #symmetricDifference",
          function () {
            const operation = $(this).text();
            const input = $(".set-operation");
            input.val(input.val() + operation);
          }
        );

        $("#calculate").click(() => {
          const sets = {};
          $(".set").each((index, set) => {
            const char = $(set).find(".char-input").val();
            const values = $(set).find(".set-input").val().split(",");
            sets[char] = values.map(Number).sort((a, b) => a - b);
          });

          function intersection(a, b) {
            let result = [];
            a.forEach((value) => {
              const minCount = Math.min(
                a.filter((x) => x === value).length,
                b.filter((x) => x === value).length
              );
              for (let i = 0; i < minCount; i++) {
                result.push(value);
              }
            });
            const multiSet = {};
            result.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value]++;
              } else {
                multiSet[value] = 1;
              }
            });
            const multiSetResult = Object.entries(multiSet).reduce(
              (acc, [value, count]) => {
                const minCount = Math.min(
                  a.filter((x) => x === Number(value)).length,
                  b.filter((x) => x === Number(value)).length
                );
                for (let i = 0; i < minCount; i++) {
                  acc.push(Number(value));
                }
                return acc;
              },
              []
            );
            return multiSetResult;
          }

          function union(a, b) {
            const multiSet = {};
            a.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value]++;
              } else {
                multiSet[value] = 1;
              }
            });
            b.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value] = Math.max(
                  multiSet[value],
                  b.filter((x) => x === value).length
                );
              } else {
                multiSet[value] = b.filter((x) => x === value).length;
              }
            });
            const multiSetResult = Object.entries(multiSet).reduce(
              (acc, [value, count]) => {
                for (let i = 0; i < count; i++) {
                  acc.push(Number(value));
                }
                return acc;
              },
              []
            );
            return multiSetResult;
          }

          function addition(a, b) {
            const multiSet = {};

            a.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value]++;
              } else {
                multiSet[value] = 1;
              }
            });

            b.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value]++;
              } else {
                multiSet[value] = 1;
              }
            });

            const multiSetResult = [];
            Object.entries(multiSet).forEach(([value, count]) => {
              for (let i = 0; i < count; i++) {
                multiSetResult.push(Number(value));
              }
            });

            return multiSetResult;
          }

          function subtraction(a, b) {
            const multiSet = {};
            a.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value]++;
              } else {
                multiSet[value] = 1;
              }
            });
            b.forEach((value) => {
              if (multiSet[value]) {
                multiSet[value] -= b.filter((x) => x === value).length;
              } else {
                multiSet[value] = -b.filter((x) => x === value).length;
              }
            });
            const multiSetResult = Object.entries(multiSet).reduce(
              (acc, [value, count]) => {
                for (let i = 0; i < count; i++) {
                  acc.push(Number(value));
                }
                return acc;
              },
              []
            );
            return multiSetResult;
          }

          function difference(a, b) {
            return a.filter((value) => !b.includes(value));
          }

          function evaluateExpression(expression) {
            let stack = [];
            for (let i = 0; i < expression.length; i++) {
              if (expression[i] !== ")") {
                stack.push(expression[i]);
              } else {
                let subExpression = "";
                while (stack[stack.length - 1] !== "(") {
                  subExpression = stack.pop() + subExpression;
                }
                stack.pop(); // remove the '('
                if (subExpression.length === 1) {
                  stack.push(subExpression);
                } else {
                  let subResult = evaluateSubExpression(subExpression);
                  stack.push(subResult);
                }
              }
            }
            return evaluateSubExpression(stack.join(""));
          }

          function evaluateSubExpression(subExpression) {
            const operations = subExpression.split("");
            let result = sets[operations[0]];
            for (let i = 1; i < operations.length; i += 2) {
              const operator = operations[i];
              const nextSet = sets[operations[i + 1]];
              switch (operator) {
                case "∩":
                  result = intersection(result, nextSet);
                  break;
                case "∪":
                  result = union(result, nextSet);
                  break;
                case "":
                  break;
                case "+":
                  result = addition(result, nextSet);
                  break;
                case "-":
                  result = subtraction(result, nextSet);
                  break;
                case "⊕":
                  result = difference(result, nextSet).concat(
                    difference(nextSet, result)
                  );
                  break;
                case "'":
                  result = Object.keys(sets)
                    .filter((key) => key !== operations[0])
                    .reduce((acc, key) => [...acc, ...sets[key]], []);
                  break;
                default:
                  result = [];
                  break;
              }
            }
            return result;
          }

          const operation = $(".set-operation").val();
          let result = evaluateExpression(operation);
          result.sort((a, b) => a - b);
          $(".result").val(`{${result.join(",")}}`);
        });
      });
    </script>
  </body>
</html>
